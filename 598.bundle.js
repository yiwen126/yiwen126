(self.webpackChunkcanvas_blog=self.webpackChunkcanvas_blog||[]).push([[598,465],{465:(t,e,i)=>{"use strict";i.r(e),i.d(e,{EventEmitter:()=>s});var n=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r},o=function(t,e){for(var i=0,n=e.length,o=t.length;i<n;i++,o++)t[o]=e[i];return t},s=function(){function t(){this.events={}}return t.prototype.on=function(t,e){var i;this.events[t]=null!==(i=this.events[t])&&void 0!==i?i:[],this.events[t].push(e)},t.prototype.off=function(t){this.events[t]&&delete this.events[t]},t.prototype.once=function(t,e){var i=this;this.on(t,(function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];e(n),i.off(t)}))},t.prototype.trigger=function(t){for(var e,i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];null===(e=this.events[t])||void 0===e||e.forEach((function(t){t.apply(void 0,o([],n(i)))}))},t}()},598:(t,e,i)=>{"use strict";i.r(e),i.d(e,{init:()=>h});var n=i(465),o=function(t,e,i,n){return new(i||(i=Promise))((function(o,s){function r(t){try{h(n.next(t))}catch(t){s(t)}}function a(t){try{h(n.throw(t))}catch(t){s(t)}}function h(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}h((n=n.apply(t,e||[])).next())}))},s=function(t,e){var i,n,o,s,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,n=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(o=r.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){r=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){r.label=s[1];break}if(6===s[0]&&r.label<o[1]){r.label=o[1],o=s;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(s);break}o[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(t){s=[6,t],n=0}finally{i=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},r=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,s=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)r.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}return r},a=function(t,e){for(var i=0,n=e.length,o=t.length;i<n;i++,o++)t[o]=e[i];return t};new n.EventEmitter;function h(){var t,e=document.getElementById("swiper"),i=e.getContext("2d"),n=0,h=0,l=n;function u(){h=e.height=window.innerHeight;var t=e.closest("section");n=e.width=t.clientWidth}u(),l=n;var c=function(){u(),f&&(f.drawOffscreenImage(),f.x=n/l*f.x,f.preX=n/l*f.preX,f.targetX=f.getTargetX(),l=n,void 0!==t&&(t.controlCanvas.width=n,t.controlCanvas.height=h,t.repaintAll(-1)))};window.addEventListener("resize",c);var f,v=function(){function t(t){var e=this,i=t.swiper,o=t.pagination,s=t.navigation;this.onmousemove=function(t){e.mouse=e.getMousePos(e.controlCanvas,t),e.isInsideRect(e.mouse,{x:20,y:h/2-20,width:20,height:40})?!0!==e.hoverLeft&&(e.hoverLeft=!0,e.repaintAll(-1)):!1!==e.hoverLeft&&(e.hoverLeft=!1,e.repaintAll(-1)),e.isInsideRect(e.mouse,{x:n-40,y:h/2-20,width:20,height:40})?!0!==e.hoverRight&&(e.hoverRight=!0,e.repaintAll(-1)):!1!==e.hoverRight&&(e.hoverRight=!1,e.repaintAll(-1))},this.swiper=i,this.controlCanvas=document.createElement("canvas"),this.controlCanvas.width=n,this.controlCanvas.height=h,this.controlCanvas.className="_controlCanvas",this.ctx=this.controlCanvas.getContext("2d"),this.pagination=o,this.navigation=s,this.hoverLeft=!1,this.hoverRight=!1,this.oldFakePoint=-1,this.init()}return t.prototype.init=function(){var t=this;e.before(this.controlCanvas),"object"==typeof this.pagination&&this.drawPagination(this.pagination.number,-1),this.navigation&&(this.drawNavigation(),this.swiper.mousedownArray.unshift((function(){t.isInsideRect(t.mouse,{x:20,y:h/2-20,width:20,height:40})&&f&&(f.toLeft=!0,f.toRight=f.oneRight=!1,f.preX=f.x),t.isInsideRect(t.mouse,{x:n-40,y:h/2-20,width:20,height:40})&&f&&(f.toRight=!0,f.toLeft=f.oneLeft=!1,f.preX=f.x)})),e.addEventListener("mousemove",this.onmousemove))},t.prototype.exit=function(){this.controlCanvas.remove(),e.removeEventListener("mousemove",this.onmousemove)},t.prototype.isInsideRect=function(t,e){return t.x>e.x&&t.x<e.x+e.width&&t.y<e.y+e.height&&t.y>e.y},t.prototype.getMousePos=function(t,e){var i=t.getBoundingClientRect();return{x:e.clientX-i.left,y:e.clientY-i.top}},t.prototype.repaintAll=function(t){this.ctx.clearRect(0,0,this.controlCanvas.width,this.controlCanvas.height),"object"==typeof this.pagination&&this.drawPagination(this.pagination.number,t),this.navigation&&this.drawNavigation()},t.prototype.getFakePoint=function(t){var e;return void 0===(null===(e=this.pagination)||void 0===e?void 0:e.number)?-1:-1===t?this.oldFakePoint:t<=Math.floor(this.pagination.number/2)?this.oldFakePoint=this.pagination.number-1-2*(t-1):this.pagination.number%2==0?this.oldFakePoint=2*(t-Math.floor(this.pagination.number/2)):this.oldFakePoint=2*(t-Math.floor(this.pagination.number/2))-1},t.prototype.drawPagination=function(t,e){void 0===e&&(e=1);var i;i=this.getFakePoint(e);var o=this.ctx;if(o.beginPath(),t%2==0){o.save(),o.translate(n/2,h-30);for(var s=1,r=1;r<=t;r+=2)o.save(),o.translate(10,0),a(r,s),s++,o.restore(),o.save(),o.translate(-10,0),l(r,s),s++,o.restore();o.restore()}else{o.save(),o.translate(n/2,h-30);s=1;o.beginPath(),o.moveTo(0,0),o.arc(0,0,5,0,2*Math.PI),o.fillStyle=i===s?"red":"black",o.fill(),s++;for(r=1;r<=t-1;r+=2)a(r,s),l(r,++s),s++;o.restore()}function a(t,e){o.beginPath(),o.moveTo(-20*(t+1)/2,0),o.arc(-20*(t+1)/2,0,5,0,2*Math.PI),o.fillStyle=i===e?"red":"black",o.fill()}function l(t,e){o.beginPath(),o.moveTo(20*(t+1)/2,0),o.arc(20*(t+1)/2,0,5,0,2*Math.PI),o.fillStyle=i===e?"red":"black",o.fill()}},t.prototype.drawNavigation=function(){var t=this.ctx;t.save(),t.translate(20,h/2),this.hoverLeft&&(t.fillStyle="silver",t.fillRect(0,-20,20,40)),t.beginPath(),t.moveTo(20,-20),t.lineTo(0,0),t.lineTo(20,20),t.restore(),t.save(),t.translate(n-20,h/2),this.hoverRight&&(t.fillStyle="silver",t.fillRect(-20,-20,20,40)),t.moveTo(-20,-20),t.lineTo(0,0),t.lineTo(-20,20),t.restore(),t.stroke()},t}(),g=function(){function i(t){var e=this,i=t.imgsSrc,l=t.context,u=t.timeout,c=void 0===u?1e3:u,f=t.pagination,v=void 0===f||f,g=t.navigation,d=void 0===g||g;this.assets=[],this.x=0,this.timeoutId=null,this.timeUp=!1,this.preX=0,this.canvasBuffer=!1,this.mouseDown=!1,this.offsetX=0,this.targetX=0,this.animateId=-1,this.go=!1,this.mouse=null,this.toLeft=!1,this.toRight=!1,this.oneLeft=!1,this.oneRight=!1,this.controlCanvas=null,this.onCanvasMouseDown=function(t){e.mousedownArray.forEach((function(i,n){i.call(e,t)}))},this.imgsSrc=a(a([i[i.length-1]],r(i)),[i[0]]),this.context=l,this.timeout=c,this.offscreenCanvas=document.createElement("canvas"),this.offscreenCanvas.width=this.imgsSrc.length*n,this.offscreenCanvas.height=h,this.offscreenContext=this.offscreenCanvas.getContext("2d"),this.onmousedown=this.onmousedown.bind(this),this.mousedownArray=[this.onmousedown],this.pagination=v,this.navigation=d,0===i.length&&(this.init=function(){return o(e,void 0,void 0,(function(){return s(this,(function(t){return[2]}))}))})}return i.prototype.init=function(){return o(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,this.downloadAsset()];case 1:return e.sent(),(this.pagination||this.navigation)&&(this.controlCanvas=t=new v({swiper:this,pagination:{number:this.imgsSrc.length-2},navigation:this.navigation})),this.listenMouse(),this.startAuto(),this.render(),[2]}}))}))},i.prototype.startAuto=function(t){var e=this;void 0===t&&(t=this.timeout),this.timeUp=!1,this.preX=this.x,this.timeoutId=window.setTimeout((function(){e.targetX=e.x+n,e.timeUp=!0}),t)},i.prototype.getTargetX=function(t){void 0===t&&(t=this.x);var e=(Math.floor(Math.abs(t)/n)+(Math.abs(t%n)>n/2?1:0))*n*(t>=0?1:-1);return 3===this.imgsSrc.length?(e>=n||e<=-n)&&(e=0):t<=-n?e=(this.imgsSrc.length-3)*n:t>=(this.imgsSrc.length-2)*n&&(e=0),e},i.prototype.onmousedown=function(t){if(this.timeoutId&&(window.clearTimeout(this.timeoutId),this.timeoutId=null),this.toLeft){if(this.toLeft=!1,this.oneLeft)return;return this.oneLeft=!0,this.go=!0,void(this.x%n==0?this.targetX=this.x-n:(this.targetX=this.getTargetX(),this.targetX=this.targetX<this.x?this.targetX:this.targetX-n))}if(this.toRight){if(this.toRight=!1,this.oneRight)return;return this.oneRight=!0,this.go=!0,void(this.x%n==0?this.targetX=this.x+n:(this.targetX=this.getTargetX(),this.targetX=this.targetX>this.x?this.targetX:this.targetX+n))}this.mouseDown=!0;var i=this,o=this.getPosInCanvas(t),s=this.x,r=this.onmousemove.bind(this,s,o.x);e.addEventListener("mousemove",r),window.addEventListener("mouseup",(function t(){e.removeEventListener("mousemove",r),window.removeEventListener("mouseup",t),i.targetX=i.getTargetX(),i.preX=i.x,i.mouseDown=!1,i.go=!0}))},i.prototype.onmousemove=function(t,e,i){this.x=t+e-this.getPosInCanvas(i).x,3===this.imgsSrc.length?(this.x>=n||this.x<=-n)&&(this.x=this.x%n):this.x<=-n?this.x=(this.imgsSrc.length-3)*n+this.x%n:this.x>=(this.imgsSrc.length-2)*n&&(this.x=this.x%((this.imgsSrc.length-2)*n))},i.prototype.render=function(){var t;if(this.animateId=requestAnimationFrame(this.render.bind(this)),this.timeUp||this.mouseDown||this.go){if(this.mouseDown);else{var e=this.targetX-this.preX>0?1:-1,i=Math.max(Math.abs(this.targetX-this.preX)/100,10)*e;this.x+=i,Math.abs(this.x-this.targetX)<=15&&(this.go=!1,this.x=this.targetX,3===this.imgsSrc.length?(this.x!==n&&this.x!==-n||(this.x=this.preX=0),this.startAuto()):(this.x===-n?this.x=this.preX=(this.imgsSrc.length-3)*n:this.x===(this.imgsSrc.length-2)*n&&(this.x=this.preX=0),this.startAuto()),this.oneLeft=this.oneRight=!1,null===(t=this.controlCanvas)||void 0===t||t.repaintAll(this.x/n+1))}this.context.clearRect(0,0,n,h),this.drawImage()}},i.prototype.downloadAsset=function(){var t=this,e=this.imgsSrc.map((function(e,i){return new Promise((function(n,o){var s=new Image;s.onload=function(){t.assets[i]=s,n("")},s.src=e}))}));return Promise.all(e)},i.prototype.drawImage=function(){var t=this.context;t.save(),t.translate(-n,0),t.translate(-this.x,0),this.canvasBuffer||(this.drawOffscreenImage(),this.canvasBuffer=!0),t.drawImage(this.offscreenCanvas,0,0),t.restore()},i.prototype.drawOffscreenImage=function(){var t=this.offscreenContext;this.offscreenCanvas.width=this.imgsSrc.length*n,this.offscreenCanvas.height=h,t.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),t.save(),t.translate(-n,0),this.assets.forEach((function(e,i){t.translate(n,0),t.drawImage(e,0,0,n,h)})),t.restore()},i.prototype.listenMouse=function(){e.addEventListener("mousedown",this.onCanvasMouseDown)},i.prototype.getPosInCanvas=function(t){var i=e.getBoundingClientRect();return{x:t.clientX-i.left,y:t.clientY-i.top}},i.prototype.exit=function(){var t;cancelAnimationFrame(this.animateId),e.removeEventListener("mousedown",this.onCanvasMouseDown),null===(t=this.controlCanvas)||void 0===t||t.exit()},i}();return(f=new g({imgsSrc:["/assets/a.jpg","/assets/b.jpg","/assets/c.jpg","/assets/d.png"],context:i})).init(),function(){f&&(f.exit(),f=null),window.removeEventListener("resize",c)}}}}]);