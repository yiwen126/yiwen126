(self.webpackChunkcanvas_blog=self.webpackChunkcanvas_blog||[]).push([[450,465],{465:(t,i,e)=>{"use strict";e.r(i),e.d(i,{EventEmitter:()=>o});var n=function(t,i){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var n,s,o=e.call(t),r=[];try{for(;(void 0===i||i-- >0)&&!(n=o.next()).done;)r.push(n.value)}catch(t){s={error:t}}finally{try{n&&!n.done&&(e=o.return)&&e.call(o)}finally{if(s)throw s.error}}return r},s=function(t,i){for(var e=0,n=i.length,s=t.length;e<n;e++,s++)t[s]=i[e];return t},o=function(){function t(){this.events={}}return t.prototype.on=function(t,i){var e;this.events[t]=null!==(e=this.events[t])&&void 0!==e?e:[],this.events[t].push(i)},t.prototype.off=function(t){this.events[t]&&delete this.events[t]},t.prototype.once=function(t,i){var e=this;this.on(t,(function(){for(var n=[],s=0;s<arguments.length;s++)n[s]=arguments[s];i(n),e.off(t)}))},t.prototype.trigger=function(t){for(var i,e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];null===(i=this.events[t])||void 0===i||i.forEach((function(t){t.apply(void 0,s([],n(e)))}))},t}()},450:(t,i,e)=>{"use strict";e.r(i),e.d(i,{init:()=>h});var n=e(465),s=function(t,i,e,n){return new(e||(e=Promise))((function(s,o){function r(t){try{h(n.next(t))}catch(t){o(t)}}function a(t){try{h(n.throw(t))}catch(t){o(t)}}function h(t){var i;t.done?s(t.value):(i=t.value,i instanceof e?i:new e((function(t){t(i)}))).then(r,a)}h((n=n.apply(t,i||[])).next())}))},o=function(t,i){var e,n,s,o,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(e)throw new TypeError("Generator is already executing.");for(;r;)try{if(e=1,n&&(s=2&o[0]?n.return:o[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,o[1])).done)return s;switch(n=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,n=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(s=r.trys,(s=s.length>0&&s[s.length-1])||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){r.label=o[1];break}if(6===o[0]&&r.label<s[1]){r.label=s[1],s=o;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(o);break}s[2]&&r.ops.pop(),r.trys.pop();continue}o=i.call(t,r)}catch(t){o=[6,t],n=0}finally{e=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},r=function(t,i){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var n,s,o=e.call(t),r=[];try{for(;(void 0===i||i-- >0)&&!(n=o.next()).done;)r.push(n.value)}catch(t){s={error:t}}finally{try{n&&!n.done&&(e=o.return)&&e.call(o)}finally{if(s)throw s.error}}return r},a=function(t,i){for(var e=0,n=i.length,s=t.length;e<n;e++,s++)t[s]=i[e];return t};new n.EventEmitter;function h(){var t,i=document.getElementById("swiper"),e=i.getContext("2d"),n=0,h=0,u=n;function c(){h=i.height=window.innerHeight;var t=i.closest("section");n=i.width=t.clientWidth}c(),u=n;var f=function(){c(),l&&(l.drawOffscreenImage(),l.x=n/u*l.x,l.preX=n/u*l.preX,l.targetX=l.getTargetX(),u=n,void 0!==t&&(t.controlCanvas.width=n,t.controlCanvas.height=h,t.repaint()))};window.addEventListener("resize",f);var l,v=function(){function t(t){var i=t.x,e=t.y,n=t.r;this.x=i,this.y=e,this.r=n}return t.prototype.isInside=function(t){var i=t.x,e=t.y;return Math.pow(this.x-i,2)+Math.pow(this.y-e,2)<Math.pow(this.r,2)},t.prototype.draw=function(t,i){t.beginPath(),t.moveTo(this.x,this.y),t.arc(this.x,this.y,this.r,0,2*Math.PI),t.fillStyle=i,t.fill()},t}(),g=function(){function t(t){var i=this,e=t.swiper,s=t.pagination,o=t.navigation;this.nowPagination=-1,this.paginationList=[],this.mousemoveArray=[],this.onmousedown=function(t){var e=i.paginationList.findIndex((function(e,n){var s=i.getMousePos(i.controlCanvas,t);return e.isInside(s)}));i.swiper&&-1!==e&&(i.swiper.toLeft=i.swiper.toRight=i.swiper.oneRight=i.swiper.oneLeft=!1,i.swiper.preX=i.swiper.x,i.swiper.targetX=e*n,i.swiper.go=!0)},this.listenMouse=function(){i.isInsideRect(i.mouse,{x:20,y:h/2-20,width:20,height:40})&&i.swiper&&(i.swiper.toLeft=!0,i.swiper.toRight=i.swiper.oneRight=!1,i.swiper.preX=i.swiper.x),i.isInsideRect(i.mouse,{x:n-40,y:h/2-20,width:20,height:40})&&i.swiper&&(i.swiper.toRight=!0,i.swiper.toLeft=i.swiper.oneLeft=!1,i.swiper.preX=i.swiper.x)},this.onmousemove=function(t){i.mousemoveArray.forEach((function(e,n){e.call(i,t)}))},this.onmousemoveNavigation=function(t){i.mouse=i.getMousePos(i.controlCanvas,t),i.isInsideRect(i.mouse,{x:20,y:h/2-20,width:20,height:40})?!0!==i.hoverLeft&&(i.hoverLeft=!0,i.update(-1)):!1!==i.hoverLeft&&(i.hoverLeft=!1,i.update(-1)),i.isInsideRect(i.mouse,{x:n-40,y:h/2-20,width:20,height:40})?!0!==i.hoverRight&&(i.hoverRight=!0,i.update(-1)):!1!==i.hoverRight&&(i.hoverRight=!1,i.update(-1))},this.swiper=e,this.controlCanvas=document.createElement("canvas"),this.controlCanvas.width=n,this.controlCanvas.height=h,this.controlCanvas.className="_controlCanvas",this.ctx=this.controlCanvas.getContext("2d"),this.pagination=s,this.navigation=o,this.hoverLeft=!1,this.hoverRight=!1,this.init()}return t.prototype.init=function(){i.before(this.controlCanvas),"object"==typeof this.pagination&&(this.drawPagination(this.pagination.number,0),i.addEventListener("mousedown",this.onmousedown)),this.navigation&&(this.drawNavigation(),this.swiper.mousedownArray.unshift(this.listenMouse),this.mousemoveArray.push(this.onmousemoveNavigation),i.addEventListener("mousemove",this.onmousemove))},t.prototype.exit=function(){this.controlCanvas.remove(),i.removeEventListener("mousedown",this.onmousedown),i.removeEventListener("mousemove",this.onmousemove)},t.prototype.isInsideRect=function(t,i){return t.x>i.x&&t.x<i.x+i.width&&t.y<i.y+i.height&&t.y>i.y},t.prototype.getMousePos=function(t,i){var e=t.getBoundingClientRect();return{x:i.clientX-e.left,y:i.clientY-e.top}},t.prototype.repaint=function(){this.paginationList=[],this.update(-1)},t.prototype.update=function(t){this.ctx.clearRect(0,0,this.controlCanvas.width,this.controlCanvas.height),"object"==typeof this.pagination&&this.drawPagination(this.pagination.number,t),this.navigation&&this.drawNavigation()},t.prototype.drawPagination=function(t,i){void 0===i&&(i=0),-1===i?i=this.nowPagination:this.nowPagination=i;var e=this.ctx;e.beginPath();if(0===this.paginationList.length)if(t%2==0)for(var s=n/2-(t/2*2*5+5+2*(t/2-1)*5)+5,o=h-30,r=1;r<=t;r++)this.paginationList.push(new v({x:s+4*(r-1)*5,y:o,r:5}));else for(s=n/2-((t-1)/2*4*5+5)+5,o=h-30,r=1;r<=t;r++)this.paginationList.push(new v({x:s+4*(r-1)*5,y:o,r:5}));this.paginationList.forEach((function(t,n){i===n?t.draw(e,"red"):t.draw(e,"black")}))},t.prototype.drawNavigation=function(){var t=this.ctx;t.save(),t.translate(20,h/2),this.hoverLeft&&(t.fillStyle="silver",t.fillRect(0,-20,20,40)),t.beginPath(),t.moveTo(20,-20),t.lineTo(0,0),t.lineTo(20,20),t.restore(),t.save(),t.translate(n-20,h/2),this.hoverRight&&(t.fillStyle="silver",t.fillRect(-20,-20,20,40)),t.moveTo(-20,-20),t.lineTo(0,0),t.lineTo(-20,20),t.restore(),t.stroke()},t}(),p=function(){function e(t){var i=this,e=t.imgsSrc,u=t.context,c=t.timeout,f=void 0===c?1e3:c,l=t.pagination,v=void 0===l||l,g=t.navigation,p=void 0===g||g;this.assets=[],this.x=0,this.timeoutId=null,this.timeUp=!1,this.preX=0,this.canvasBuffer=!1,this.mouseDown=!1,this.offsetX=0,this.targetX=0,this.animateId=-1,this.go=!1,this.mouse=null,this.toLeft=!1,this.toRight=!1,this.oneLeft=!1,this.oneRight=!1,this.controlCanvas=null,this.onCanvasMouseDown=function(t){i.mousedownArray.forEach((function(e,n){e.call(i,t)}))},this.imgsSrc=a(a([e[e.length-1]],r(e)),[e[0]]),this.context=u,this.timeout=f,this.offscreenCanvas=document.createElement("canvas"),this.offscreenCanvas.width=this.imgsSrc.length*n,this.offscreenCanvas.height=h,this.offscreenContext=this.offscreenCanvas.getContext("2d"),this.onmousedown=this.onmousedown.bind(this),this.mousedownArray=[this.onmousedown],this.mousemoveArray=[this.onmousemove],this.pagination=v,this.navigation=p,0===e.length&&(this.init=function(){return s(i,void 0,void 0,(function(){return o(this,(function(t){return[2]}))}))})}return e.prototype.init=function(){return s(this,void 0,void 0,(function(){return o(this,(function(i){switch(i.label){case 0:return[4,this.downloadAsset()];case 1:return i.sent(),(this.pagination||this.navigation)&&(this.controlCanvas=t=new g({swiper:this,pagination:{number:this.imgsSrc.length-2},navigation:this.navigation})),this.listenMouse(),this.startAuto(),this.render(),[2]}}))}))},e.prototype.startAuto=function(t){var i=this;void 0===t&&(t=this.timeout),this.timeUp=!1,this.preX=this.x,this.timeoutId=window.setTimeout((function(){i.targetX=i.x+n,i.timeUp=!0}),t)},e.prototype.getTargetX=function(t){void 0===t&&(t=this.x);var i=(Math.floor(Math.abs(t)/n)+(Math.abs(t%n)>n/2?1:0))*n*(t>=0?1:-1);return 3===this.imgsSrc.length?(i>=n||i<=-n)&&(i=0):t<=-n?i=(this.imgsSrc.length-3)*n:t>=(this.imgsSrc.length-2)*n&&(i=0),i},e.prototype.onmousedown=function(t){if(this.timeoutId&&(window.clearTimeout(this.timeoutId),this.timeoutId=null),!this.go){if(this.toLeft){if(this.toLeft=!1,this.oneLeft)return;return this.oneLeft=!0,this.go=!0,void(this.x%n==0?this.targetX=this.x-n:(this.targetX=this.getTargetX(),this.targetX=this.targetX<this.x?this.targetX:this.targetX-n))}if(this.toRight){if(this.toRight=!1,this.oneRight)return;return this.oneRight=!0,this.go=!0,void(this.x%n==0?this.targetX=this.x+n:(this.targetX=this.getTargetX(),this.targetX=this.targetX>this.x?this.targetX:this.targetX+n))}this.mouseDown=!0;var e=this,s=this.getPosInCanvas(t),o=this.x,r=this.onmousemove.bind(this,o,s.x);i.addEventListener("mousemove",r),window.addEventListener("mouseup",(function t(){i.removeEventListener("mousemove",r),window.removeEventListener("mouseup",t),e.targetX=e.getTargetX(),e.preX=e.x,e.mouseDown=!1,e.go=!0}))}},e.prototype.onmousemove=function(t,i,e){this.x=t+i-this.getPosInCanvas(e).x,3===this.imgsSrc.length?(this.x>=n||this.x<=-n)&&(this.x=this.x%n):this.x<=-n?this.x=(this.imgsSrc.length-3)*n+this.x%n:this.x>=(this.imgsSrc.length-2)*n&&(this.x=this.x%((this.imgsSrc.length-2)*n))},e.prototype.render=function(){var t;if(this.animateId=requestAnimationFrame(this.render.bind(this)),this.timeUp||this.mouseDown||this.go){if(this.mouseDown);else{var i=this.targetX-this.preX>0?1:-1,e=Math.max(Math.abs(this.targetX-this.preX)/100,10)*i;this.x+=e,Math.abs(this.x-this.targetX)<=15&&(this.go=!1,this.x=this.targetX,3===this.imgsSrc.length?(this.x!==n&&this.x!==-n||(this.x=this.preX=0),this.startAuto()):(this.x===-n?this.x=this.preX=(this.imgsSrc.length-3)*n:this.x===(this.imgsSrc.length-2)*n&&(this.x=this.preX=0),this.startAuto()),this.oneLeft=this.oneRight=!1,null===(t=this.controlCanvas)||void 0===t||t.update(this.x/n))}this.context.clearRect(0,0,n,h),this.drawImage()}},e.prototype.downloadAsset=function(){var t=this,i=this.imgsSrc.map((function(i,e){return new Promise((function(n,s){var o=new Image;o.onload=function(){t.assets[e]=o,n("")},o.src=i}))}));return Promise.all(i)},e.prototype.drawImage=function(){var t=this.context;t.save(),t.translate(-n,0),t.translate(-this.x,0),this.canvasBuffer||(this.drawOffscreenImage(),this.canvasBuffer=!0),t.drawImage(this.offscreenCanvas,0,0),t.restore()},e.prototype.drawOffscreenImage=function(){var t=this.offscreenContext;this.offscreenCanvas.width=this.imgsSrc.length*n,this.offscreenCanvas.height=h,t.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),t.save(),t.translate(-n,0),this.assets.forEach((function(i,e){t.translate(n,0),t.drawImage(i,0,0,n,h)})),t.restore()},e.prototype.listenMouse=function(){i.addEventListener("mousedown",this.onCanvasMouseDown)},e.prototype.getPosInCanvas=function(t){var e=i.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}},e.prototype.exit=function(){var t;cancelAnimationFrame(this.animateId),i.removeEventListener("mousedown",this.onCanvasMouseDown),null===(t=this.controlCanvas)||void 0===t||t.exit()},e}();return(l=new p({imgsSrc:["/assets/a.jpg","/assets/b.jpg","/assets/c.jpg","/assets/d.png"],context:e})).init(),function(){l&&(l.exit(),l=null),window.removeEventListener("resize",f)}}}}]);